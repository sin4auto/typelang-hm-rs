<!-- パス: docs/typeclass-extension.md -->
<!-- 役割: 将来導入したい型クラス／高階関数アイデアを整理するメモ -->
<!-- 意図: 教材コアから外した機能を安全に再導入するための検討事項を保持する -->
<!-- 関連ファイル: README.md, AGENTS.md, src/infer.rs -->

# 型クラス拡張ロードマップ（検討メモ）

現在の TypeLang HM では学習負荷を抑えるため、`Functor` や `Foldable` といった高階抽象は除外しています。本メモは拡張を再検討する際の論点をまとめるためのプレースホルダです。実装に着手する前に内容を更新し、`AGENTS.md` のプロトコルに従って承認を得てください。

## 1. 追加候補
- `Functor` / `Foldable` / `Traversable` の導入と、既存型（リスト、タプル、Maybe など）へのインスタンス方針
- `map` / `foldl` / `foldr` / `traverse` などの高階関数と型推論への影響
- REPL 表示・エラーメッセージ拡張の整合性チェック

## 2. 実装チェックリスト
1. `infer::initial_class_env` と `infer::initial_env` に新しいスキームを登録する。
2. `evaluator::initial_env` へ対応するプリミティブ実装を追加し、非対応型には明示的なエラーを返す。
3. `examples/` と `tests/` に段階的なサンプル・回帰テストを増やし、学習フェーズに合わせて切り替えられるよう調整する。
4. ドキュメント（README, EBNF, このメモ）を更新し、利用者が差分を追える状態を確保する。

## 3. 段階的リリース案
- **Phase 1**: `Functor []` と `map` のみ導入し、リスト処理の教材に限定する。
- **Phase 2**: `Foldable` を追加し、`foldl` / `foldr` で畳み込みパターンを学習できるようにする。
- **Phase 3**: `Traversable` を検討し、効果的な学習価値がある場合のみ導入。必要なら公式ドキュメントへ昇格させる。

## 4. リスクとロールバック
- 型クラス拡張は型推論とエラーメッセージの複雑さを急激に増大させる恐れがあります。
- 段階導入と feature flag（例: `:set extensions functor`）などで影響範囲を限定し、問題があれば旗で巻き戻せるよう設計してください。

> 実装に進む際は、ユーザーに承認を取り、関連ドキュメントとテストを先に更新したうえで着手すること。
